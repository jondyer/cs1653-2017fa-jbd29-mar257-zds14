@startuml
title __T3: Unauthorized File Servers__
actor Bob
participant FS
participant Trent

alt K<sub>BT</sub> not established
	Bob -> Trent: Bob || g<sup>u</sup> mod q
	note left: Choose random u
	Trent -> Bob: Trent || [Bob || g<sup>t</sup> mod q]k<sub>T</sub><sup>-1</sup>
	Bob -> Bob: Verify Trent through k<sub>T</sub>
	note left: K<sub>BT</sub> = g<sup>ut</sup> mod p
end

|||

Bob -> Trent: Bob || {FileServer_X}K<sub>BT</sub>
Trent -> Bob: {FileServer_X || k<sub>FSX</sub>}K<sub>BT</sub>

|||

create FS
Bob -> FS: Bob || FileServer_X || g<sup>b</sup> mod q
note left: Choose random b

FS -> Bob: FS<sub>X</sub> || [Bob || g<sup>f</sup> mod q]k<sub>FSX</sub><sup>-1</sup>
Bob -> Bob: Verify FileServer_X through k<sub>FSX</sub>
note left: K<sub>BF</sub> = g<sup>bf</sup> mod p

@enduml