@startuml
title __T3: Unauthorized File Servers__
actor Bob
participant FS
participant Trent
participant GroupServer

Bob <--> GroupServer: Share session secret K<sub>GB</sub>
GroupServer <--> Trent: Share strong symmetric secret K<sub>TG</sub>
Bob -> Trent: Bob || {[pToken]k<sub>G</sub><sup>-1</sup> || FileServer_X || C}K<sub>GB</sub>
note left: Challenge C sent to verify Trent

Trent -> GroupServer: {Bob}K<sub>TG</sub>
note right: Trent requests Bob's session key
GroupServer -> Trent: {Bob || K<sub>GB</sub>}K<sub>TG</sub>
Trent -> Bob: {k<sub>FSX</sub> || k<sub>B</sub><sup>-1</sup> || C}K<sub>GB</sub>

Bob -> Bob: Generate K<sub>BF</sub>
create FS
Bob -> FS: Bob || [FileServer_X || {K<sub>BF</sub>}k<sub>FSX</sub>]k<sub>B</sub><sup>-1</sup>
FS -> Trent: Bob
note right: FS requests Bob's public key
Trent -> FS: k<sub>B</sub>

FS -> FS: Verify Bob through k<sub>B</sub>
FS -> Bob: FS<sub>X</sub> || {K<sub>BF</sub>}k<sub>B</sub>
Bob -> Bob: Verify that received K<sub>BF</sub> is \nthe same as the one sent

Bob <--> FS: Share K<sub>BF</sub>
@enduml